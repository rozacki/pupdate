{
  "Monitoring":{
    "Dsn":"root:root@tcp(dockerhost:32768)/MOT2_2"
  },
  "Notifications":{
    "Email":"chris.rozacki@valtech.co.uk"
  },
  "Tasks":[
    {
      "Name": "update existing makes",
      "Description":"updates all existsing based on id makes regardless of last_updated_on",
      "SessionParam": "",
      "Dsn": "root:root@tcp(dockerhost:32768)/MOT2_2",
      "Exec": "update MOTH3.vehiclemanufacturer mm left join make m on mm.id=m.id set mm.name=m.name",
      "MaxAttempts": 3,
      "Debug":false
    },
    {
      "Name": "add new makes",
      "Description":"creates new vehicle in moth.vehicle database if does not exist in moth",
      "SessionParam": "",
      "Dsn": "root:root@tcp(dockerhost:32768)/MOT2_2",
      "Exec": "insert into MOTH3.vehiclemanufacturer (id, name) select make.id, make.name from make left outer join MOTH3.vehiclemanufacturer on make.id=MOTH3.vehiclemanufacturer.id where MOTH3.vehiclemanufacturer.id is NULL;",
      "MaxAttempts": 3,
      "Debug":false
    },
    {
      "Name": "update vehicles",
      "Description":"updates all vehicles which have changed since",

      "Dsn": "root:root@tcp(dockerhost:32768)/MOT2_2","SessionParam": "",
      "Exec": "select * from mot_test where last_updated_on>'$last_etl';",
      "ExecTab":[
        "update MOTH3.vehicle hv ",
        "inner join vehicle v on hv.id=v.id ",
        "left join fuel_type as f on v.fuel_type_id=f.id ",
        "left join colour_lookup as c on v.primary_colour_id=c.id ",
        "left join wheelplan_type as w on v.wheelplan_type_id=w.id ",
        "left join vehicle_v5c as v5c on v.id=v5c.vehicle_id ",
        "left join make as make on v.make_id=make.id ",
        "left join model as model on v.model_id=model.id ",
        "set  manufacturer_id=v.make_id ",
        ",hv.registration=v.registration ",
        ",hv.model=model.name ",
        ",hv.vin=v.vin ",
        ",hv.dateFirstUsed=v.first_used_date ",
        ",hv.fuelType=f.name ",
        ",hv.colour=c.name ",
        ",hv.wheelPlan=w.name ",
        ",hv.v5cReference=v5c.v5c_ref ",
        ",hv.approvalType=''",
        " where v5c.last_seen is  null",
        " and v.last_updated_on>'$last_etl'"
      ],
      "MaxAttempts": 3,
      "Debug":true
    }
  ,
    {
      "Name": "add new vehicles",
      "Description": "uadd new vehiclese",
      "Dsn": "root:root@tcp(dockerhost:32768)/MOT2_2",
      "ExecTab": ["insert into MOTH3.vehicle",
        " (id, manufacturer_id,registration, model, vin, dateFirstUsed, fuelType, colour, wheelPlan, v5cReference, approvalType)",
        " select v.id, v.make_id, v.registration, model.name, v.vin, v.first_used_date, f.name fuel_type, c.name colour, w.name wheel_plan, v5c.v5c_ref, 'approval_type'",
        " from vehicle as v left join MOTH3.vehicle hv on hv.id=v.id",
        " left join fuel_type as f on v.fuel_type_id=f.id",
        " left join colour_lookup as c on v.primary_colour_id=c.id",
        " left join wheelplan_type as w on v.wheelplan_type_id=w.id",
        " left join vehicle_v5c as v5c on v.id=v5c.vehicle_id",
        " left join make as make on v.make_id=make.id",
        " left join model as model on v.model_id=model.id",
        " where hv.id is null and v5c.last_seen is null;"],
      "MaxAttempts": 3,
      "Debug": true
    }
  ]
}